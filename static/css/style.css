/* ================================
   MODAL SYSTEM
   ================================ */

/* Base Modal Structure */
.modal {
   position: fixed;
   inset: 0;  /* Cleaner than top/left/right/bottom */
   display: none;
   z-index: var(--z-modal-backdrop);
   backdrop-filter: var(--modal-blur);
   background: var(--modal-backdrop);
   align-items: center;
   justify-content: center;
   
   /* Dynamic padding using your spacing variables */
   padding: clamp(var(--space-lg), 4vw, var(--space-4xl));
   
   /* Safe areas on top of dynamic padding */
   padding: max(clamp(var(--space-lg), 4vw, var(--space-4xl)), env(safe-area-inset-top))
          max(clamp(var(--space-lg), 4vw, var(--space-4xl)), env(safe-area-inset-right))
          max(clamp(var(--space-lg), 4vw, var(--space-4xl)), env(safe-area-inset-bottom))
          max(clamp(var(--space-lg), 4vw, var(--space-4xl)), env(safe-area-inset-left));
}

.modal-actions {
    padding: var(--space-lg) var(--space-xl);
    border-top: 1px solid var(--modal-line);
    display: flex;
    gap: var(--space-md);
    background: white;
    position: sticky;
    bottom: 0;
    border-radius: 0 0 var(--radius-xl) var(--radius-xl);
    
    /* Ensure buttons don't get too close to home indicator */
    padding-bottom: calc(var(--space-lg) + env(safe-area-inset-bottom));
}


.modal.active {
   display: flex;
}

/* Modal Content Container */
.modal-content {
   /* Dynamic width that scales better */
   width: min(90%, 500px);  /* Better than fixed 90% */
   
   /* Dynamic height using clamp */
   max-height: clamp(400px, 85dvh, 800px);
   
   /* Account for safe areas more elegantly */
   max-height: calc(clamp(400px, 85dvh, 800px) - env(safe-area-inset-top) - env(safe-area-inset-bottom));
   
   /* Dynamic padding that scales */
/*    padding: clamp(var(--space-lg), 3vw, var(--space-3xl)); */
   padding: 0;
   
   /* Clean up properties */
   display: flex;
   flex-direction: column;
   overflow: hidden;
   position: relative;
   z-index: var(--z-modal-content);
   background: var(--bg-white);
   border-radius: var(--radius-xl);
   box-shadow: var(--shadow-xl);
   animation: modalSlideIn var(--transition-slow);
   height: auto;
}

.modal-header {
   /* Dynamic padding */
   padding: clamp(var(--space-md), 3vw, var(--space-2xl));
   
   /* Keep existing properties */
   background: var(--primary-gradient);
   color: var(--white);
   text-align: center;
   position: sticky;
   top: 0;
   z-index: 10;
   flex-shrink: 0;
   border-bottom: 1px solid var(--modal-line);
   border-radius: var(--radius-xl) var(--radius-xl) 0 0;
}

.modal-title {
   color: var(--white);
   margin: 0;
   /* Dynamic font size using your text scale */
   font-size: clamp(var(--text-lg), 4vw, var(--text-2xl));
   font-weight: 700;
}

.modal-subtitle {
   color: var(--white);
   margin: var(--space-xs) 0 0;
   /* Dynamic font size */
   font-size: clamp(var(--text-sm), 2.5vw, var(--text-md));
   opacity: 0.9;
}

/* Modal Close Button */
.modal-close {
   position: absolute;
   /* Dynamic positioning that scales */
   right: clamp(var(--space-md), 3vw, var(--space-2xl));
   top: clamp(var(--space-md), 3vw, var(--space-2xl));
   
   /* Dynamic size using clamp */
   width: clamp(32px, 5vw, 44px);
   height: clamp(32px, 5vw, 44px);
   
   /* Clean styling */
   display: flex;
   align-items: center;
   justify-content: center;
   background: rgba(255, 255, 255, 0.2);
   backdrop-filter: blur(8px);
   border: 2px solid rgba(255, 255, 255, 0.3);
   border-radius: var(--radius-circle);
   color: var(--white);
   cursor: pointer;
   
   /* Dynamic font size */
   font-size: clamp(var(--text-lg), 3vw, var(--text-2xl));
   
   /* Transitions */
   transition: all var(--transition);
   z-index: var(--z-status-modals);
}

.modal-close:hover {
   background: rgba(255, 255, 255, 0.3);
   transform: scale(1.1);
}

/* Modal Body */
.modal-body {
   flex: 1;
   /* Dynamic padding that scales with viewport */
   padding: clamp(var(--space-lg), 4vw, var(--space-3xl)) 
          clamp(var(--space-md), 3vw, var(--space-2xl));
   
   /* Smooth scrolling */
   overflow-y: auto;
   -webkit-overflow-scrolling: touch;
   overscroll-behavior: contain;
   
   /* Flexbox setup */
   display: flex;
   flex-direction: column;
   min-height: 0;
   
   /* Optional: Dynamic gap between body elements */
   gap: clamp(var(--space-md), 2vw, var(--space-xl));
}

/* Modal Actions/Footer */
.modal-actions {
   display: flex;
   justify-content: center;
   flex-wrap: wrap;  /* Allow wrapping on small screens */
   
   /* Dynamic gap and padding */
   gap: clamp(var(--space-sm), 2vw, var(--space-lg));
   padding: clamp(var(--space-md), 3vw, var(--space-xl));
   
   /* Styling */
   flex-shrink: 0;
   border-top: 1px solid var(--border-light);
   background: var(--bg-section);
   
   /* Round bottom corners to match modal */
   border-radius: 0 0 var(--radius-xl) var(--radius-xl);
   
   /* Safe area for bottom (home indicator on iPhone) */
   padding-bottom: max(clamp(var(--space-md), 3vw, var(--space-xl)), env(safe-area-inset-bottom));
}

/* Optional: Make action buttons responsive too */
.modal-actions .btn {
   /* Dynamic padding for buttons */
   padding: clamp(var(--space-sm), 2vw, var(--space-md)) 
          clamp(var(--space-lg), 3vw, var(--space-2xl));
   
   /* Dynamic font size */
   font-size: clamp(var(--text-sm), 2.5vw, var(--text-md));
   
   /* Minimum width but allow growth */
   min-width: clamp(100px, 30vw, 150px);
   flex: 1 1 auto;
   width: 100%;
}

.modal-overlay {
    position: fixed;
    inset: 0;
    display: none;
    z-index: var(--z-onboarding, 9999);
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    align-items: center;
    justify-content: center;
    
    /* Dynamic padding that accounts for safe areas */
    padding: clamp(1rem, 4vw, 2rem);
    padding: max(clamp(1rem, 4vw, 2rem), env(safe-area-inset-top))
            max(clamp(1rem, 4vw, 2rem), env(safe-area-inset-right))
            max(clamp(1rem, 4vw, 2rem), env(safe-area-inset-bottom))
            max(clamp(1rem, 4vw, 2rem), env(safe-area-inset-left));
}

.modal-overlay.active {
    display: flex;
    animation: fadeIn 0.3s ease;
}

.modal-container {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    width: 100%;
    position: relative;
    animation: slideUp 0.4s ease;
    max-height: 90vh;
    max-height: 90dvh;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

/* Shared button styles */
.modal-skip-btn,
.modal-close-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.modal-close-btn {
    width: 32px;
    height: 32px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    border-radius: 50%;
}

.modal-skip-btn:hover,
.modal-close-btn:hover {
    background: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

















/* ================================
   COMPONENTS
   ================================ */
.card {
   background: var(--bg-card-home);
   border-radius: var(--radius-pill);
   overflow: hidden;
   box-shadow: var(--shadow-card-home);
   border: 1px solid rgba(139, 92, 246, 0.07);
}

/* ================================
   BUTTONS
   ================================ */

.btn {
   border: none;
   background: none;
   border-radius: var(--radius-xl);
   padding: var(--space-lg);
   font-weight: 600;
   cursor: pointer;
   box-shadow: var(--shadow);
   transition: all 0.25s ease;
   font-size: var(--text-md);
   line-height: 1.2;
   text-decoration: none;
   display: inline-flex;
   align-items: center;
   justify-content: center;
   gap: var(--space-sm);
   min-height: 48px; /* Accessibility: minimum touch target */
   font-family: inherit;
}

.btn:disabled {
   opacity: 0.6;
   cursor: not-allowed;
   transform: none !important;
}

.btn:disabled:hover {
   transform: none;
   box-shadow: var(--shadow);
}

/* Button Variants */
.btn-primary {
   background: var(--primary-gradient);
   color: var(--text-white);
   flex: 1;
}

.btn-primary:hover:not(:disabled) {
   transform: translateY(-1px);
   box-shadow: var(--shadow-lg);
}

.btn-secondary {
   background: var(--light-purple);
   color: var(--text-secondary);
   backdrop-filter: blur(10px);
   border: 2px solid var(--border-light);
   flex: 1;
}

.btn-secondary:hover:not(:disabled) {
   transform: translateY(-1px);
   border-color: var(--border-purple);
   background: var(--bg-purple);
   color: var(--text-primary);
}

.btn-success {
    background: var(--success-gradient);
    color: var(--text-white);
}

.btn-success:hover:not(:disabled) {
   transform: translateY(-1px);
   box-shadow: var(--shadow-lg);
}

.btn-warning {
    background: var(--warning-gradient);
    color: var(--text-white);
}

.btn-warning:hover:not(:disabled) {
   transform: translateY(-1px);
   box-shadow: var(--shadow-lg);
}

.btn-error {
    background: var(--error-gradient);
    color: var(--text-white);
}

.btn-error:hover:not(:disabled) {
   transform: translateY(-1px);
   box-shadow: var(--shadow-lg);
}

.btn-info {
    background: var(--info-gradient);
    color: var(--text-white);
}

.btn-info:hover:not(:disabled) {
   transform: translateY(-1px);
   box-shadow: var(--shadow-lg);
}

.btn-outline {
    background: var(--bg-white);
    color: var(--text-primary);
    border: 2px solid var(--border-light);
}

.btn-outline:hover:not(:disabled) {
    background: var(--bg-purple);
    border-color: var(--border-purple);
    color: var(--text-primary);
    transform: translateY(-1px);
}

.btn-ghost {
    background: transparent;
    color: var(--text-secondary);
    box-shadow: none;
    border: 2px solid transparent;
}

.btn-ghost:hover:not(:disabled) {
    background: var(--hover-subtle);
    color: var(--text-primary);
    border-color: var(--border-light);
}

.btn-link {
    background: none;
    color: var(--purple);
    text-decoration: underline;
    box-shadow: none;
    padding: var(--space-sm);
}

.btn-link:hover:not(:disabled) {
    color: var(--dark-blue);
    text-decoration: none;
    transform: none;
}

/* Button Sizes */
.btn-sm {
   padding: var(--space-sm) var(--space-lg);
   font-size: var(--text-sm);
   min-height: 40px;
}

.btn-lg {
   padding: var(--space-xl) var(--space-2xl);
   font-size: var(--text-lg);
   min-height: 56px;
}

.btn-xs {
   padding: var(--space-xs) var(--space-md);
   font-size: var(--text-xs);
   min-height: 32px;
   border-radius: var(--radius-lg);
}

/* Button Widths */
.btn-full {
   width: 100%;
}

.btn-auto {
   width: auto;
   flex: none;
}

/* Button Groups */
.btn-group {
   display: flex;
   gap: var(--space-sm);
}

.btn-group .btn {
   flex: 1;
}

.btn-group-vertical {
   display: flex;
   flex-direction: column;
   gap: var(--space-sm);
}

.btn-group-vertical .btn {
   width: 100%;
}









/* ================================
   TOGGLE SWITCH
   ================================ */

.toggle-container {
   border-radius: var(--radius-xl);
   display: flex;
   position: relative;
   border: 2px solid rgba(255, 255, 255, 0.3);
}

.toggle-track {
   position: relative;
   display: flex;
   align-items: center;
}

.toggle-option {
   padding: 8px 16px;
   font-size: var(--text-sm);
   font-weight: 600;
   color: rgba(255, 255, 255, 0.7);
   cursor: pointer;
   transition: color var(--transition);
   position: relative;
   z-index: 2;
   white-space: nowrap;
}

.toggle-option.active {
   color: var(--text-primary);
}

.toggle-thumb {
   position: absolute;
   top: 0;
   left: 0;
   height: 100%;
   background: white;
   border-radius: var(--radius-xl);
   transition: all var(--transition-fast);
   box-shadow: var(--shadow-sm);
   opacity: 1 !important;
   visibility: visible !important;
   pointer-events: none;
   z-index: 1;
   transform: translateX(0);
   will-change: transform;
}





/* ================================
   GF STATUS INDICATORS
   ================================ */

.gf-indicator {
   background: var(--success-gradient);
   color: white;
   padding: var(--space-xs) var(--space-md);
   border-radius: var(--radius-pill);
   font-size: 0.8rem;
   font-weight: 600;
   white-space: nowrap;
   text-align: center;
}

.gf-indicator.always-tap-cask {
    background: linear-gradient(135deg, #FFD700 0%, #FDB904 100%);
    color: var(--text-primary);
}

.gf-indicator.always-bottle-can {
    background: linear-gradient(135deg, #00F500 0%, #00C400 100%);
    color: var(--text-white);
}

.gf-indicator.currently {
    background: var(--orange-gradient);
    color: var(--text-white);
}

.gf-indicator.not-currently {
    background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
    color: var(--text-white);
}

.gf-indicator.unknown {
    background: linear-gradient(135deg, #9CA3AF 0%, #6B7280 100%);
    color: var(--text-white);
}

@media (min-width:1025px) {
   .nav-back-btn {
      position: absolute;
      right: 0;
      margin: var(--space-xl);
   }
   
   .near-me-section,
   .buy-beer-section {
      width: 100%;
      padding: 0 var(--space-lg);
   }
   
   .near-me-content,
   .buy-beer-content {
      text-align: center;
   }
}

@supports (-webkit-touch-callout: none) {
    /* iOS only */
    input[type="text"],
    input[type="search"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    input[type="password"],
    textarea,
    select {
        font-size: 16px !important;
        -webkit-text-size-adjust: 100%;
    }
    
    /* Ensure inputs still look good with larger font */
    .search-input,
    .modal input,
    .form-control {
        font-size: 16px !important;
        line-height: 1.4;
        padding: 12px 16px;
    }
    
    /* Specifically for places search */
    #placesSearchInput {
        font-size: 16px !important;
    }
}



/* ================================
   UPDATE COMMUNITY HOME
   ================================ */
.community-home,
.home-page {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    background: var(--bg-home);
    position: relative;
    z-index: 1;
    
    /* Add safe area padding for content */
    padding-bottom: env(safe-area-inset-bottom);
}

/* ================================
   UPDATE RESULTS CONTAINER
   ================================ */
.results-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
    background: var(--primary-gradient);
    min-height: 0;
    
    /* Safe area support */
    padding-bottom: env(safe-area-inset-bottom);
}

/* ================================
   UPDATE VENUE DETAILS
   ================================ */
.venue-action-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    padding: var(--space-xl);
    background: var(--bg-white);
    border-top: 1px solid var(--divider-color);
    margin-top: auto;
    
    /* Push buttons above home indicator */
    padding-bottom: calc(var(--space-xl) + env(safe-area-inset-bottom));
}

/* ================================
   TOASTS AND FLOATING ELEMENTS
   ================================ */
.toast {
    /* If toasts appear at bottom, account for home indicator */
    bottom: calc(var(--nav-height) + env(safe-area-inset-bottom) + var(--space-lg));
}

/* Any floating action buttons */
.fab,
.floating-action-button {
    bottom: calc(var(--nav-height) + env(safe-area-inset-bottom) + var(--space-xl));
}

/* ================================
   MORE MENU (above bottom nav)
   ================================ */
.more-menu {
    position: absolute;
    bottom: 100%;
    right: 0;
    background: var(--bg-white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    min-width: 200px;
    display: none;
    
    /* Adjust margin to account for nav height with safe area */
    margin-bottom: calc(var(--space-sm) + env(safe-area-inset-bottom));
}


/* ================================
   LANDSCAPE MODE ADJUSTMENTS
   ================================ */
@media (orientation: landscape) {
    /* In landscape, safe areas are on the sides */
    .overlay,
    .modal {
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
    }
    
    /* Adjust containers for landscape notches */
    .results-container,
    .venue-details-container,
    .search-container {
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
    }
}

/* Fix modal container height issues on mid-size phones */
@media (min-width: 375px) and (max-width: 430px) and (min-height: 700px) {
    .modal-overlay {
        padding: 1rem;
    }
    
    .modal-container {
        max-height: calc(100vh - 2rem);
        max-height: calc(100dvh - 2rem);
    }
}
