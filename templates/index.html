<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Coeliacs Like Beer Too! {{ cache_buster }}</title>
        
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v={{ cache_buster }}">
        
        <!-- Leaflet CSS -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
        <!-- Leaflet MarkerCluster CSS -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
        <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
        
        <!-- Google Analytics with GDPR compliance -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-WSHR39KSXS"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            
            // Set default consent to denied (GDPR compliant)
            gtag('consent', 'default', {
                'analytics_storage': 'denied'
            });
            
            gtag('js', new Date());
            gtag('config', 'G-WSHR39KSXS', {
                'anonymize_ip': true,
                'cookie_flags': 'SameSite=None;Secure'
            });
        </script>
    </head>
    <body>

        <!-- Bottom navigation bar -->
            <nav class="bottom-nav">
                <a href="/" class="nav-item">
                    <div class="nav-icon">üè†</div>
                    <div class="nav-label">Home</div>
                </a>
                <a href="#" data-action="show-full-map" class="nav-item">
                    <div class="nav-icon">üó∫Ô∏è</div>
                    <div class="nav-label">Map</div>
                </a>
                <a href="/breweries" class="nav-item">
                    <div class="nav-icon">üç∫</div>
                    <div class="nav-label">Breweries</div>
                </a>
                <a href="/about" class="nav-item">
                    <div class="nav-icon">‚ÑπÔ∏è</div>
                    <div class="nav-label">About</div>
                </a>
                <a href="/more" class="nav-item">
                    <div class="nav-icon">‚ãØ</div>
                    <div class="nav-label">More</div>
                </a>
            </nav>        
        </div>
        
        <div class="home-page">
            <!-- Hero Section -->
            <div class="hero-section">
                <div class="hero-content">
                    <h1 class="hero-title">Coeliacs Like Beer Too!</h1>
                    <p class="hero-subtitle">The UK's largest community-driven guide to gluten free beer</p>
                    
                    <div class="hero-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="totalPubs">Loading...</span>
                            <span class="stat-label">Pubs in the UK</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="gfPubs">Loading...</span>
                            <span class="stat-label">Serving GF Beer</span>
                        </div>
                    </div>
                </div>
            </div>

            
        
            <!-- Search Section -->
            <div class="search-section" id="search">
                <div class="search-container">
                    <div class="search-card">
                        <div class="search-header">
<!--                             <h2 class="section-title">üîç What are you searching for? üç∫</h2> -->
                        </div>
                        <div class="search-body">
                            <div class="search-options">
                                <div class="search-option location" data-action="location-search">
                                    <span class="search-icon">üìç</span>
                                    <h3 class="search-title">Pubs Near Me</h3>
                                    <p class="search-description">Find pubs close to you, control the search distance.</p>
                                </div>
                                <div class="search-option name" data-modal="nameModal">
                                    <span class="search-icon">üè†</span>
                                    <h3 class="search-title">Pubs by Name</h3>
                                    <p class="search-description">Search for a specific pub name - "Milestone" etc</p>
                                </div>
                                <div class="search-option area" data-modal="areaModal">
                                    <span class="search-icon">üó∫Ô∏è</span>
                                    <h3 class="search-title">Pubs by Area</h3>
                                    <p class="search-description">Explore pubs in regions, cities, or postcodes</p>
                                </div>
                                <div class="search-option beer" data-modal="beerModal">
                                    <span class="search-icon">üç∫</span>
                                    <h3 class="search-title">Pubs by Beer</h3>
                                    <p class="search-description">Find pubs serving specific GF beers - "Zapato", "IPA" etc.</p>
                                </div>            
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
    
        <!-- Search Modals -->
        <div id="nameModal" class="search-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">üè† Search by Pub Name</h3>
                    <p class="modal-subtitle">Enter the name of the pub you're looking for</p>
                </div>
                <input type="text" class="form-input" placeholder="e.g. The Red Lion, Wetherspoons" id="nameInput">
                <div class="modal-actions">
                    <button class="btn btn-secondary" data-action="close-modal">Cancel</button>
                    <button class="btn btn-primary" data-action="search-name">Search</button>
                </div>
            </div>
        </div>
        
        <div id="areaModal" class="search-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">üó∫Ô∏è Search by Area</h3>
                    <p class="modal-subtitle">Find pubs in a specific location</p>
                </div>
                <div class="form-group">
                    <label class="form-label">Search by:</label>
                    <select id="areaSearchType" class="form-select" data-action="update-area-placeholder">
                        <option value="postcode">üìÆ Postcode</option>
                        <option value="city">üèôÔ∏è City/Region</option>
                    </select>
                </div>
                <input type="text" class="form-input" placeholder="Enter postcode..." id="areaInput">
                <div class="modal-actions">
                    <button class="btn btn-secondary" data-action="close-modal">Cancel</button>
                    <button class="btn btn-primary" data-action="search-area">Search</button>
                </div>
            </div>
        </div>
    
        <div id="beerModal" class="search-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">üç∫ Search by Beer</h3>
                    <p class="modal-subtitle">Find pubs serving specific gluten-free beers</p>
                </div>
                <div class="form-group">
                    <label class="form-label">Search by:</label>
                    <select id="beerSearchType" class="form-select" data-action="update-beer-placeholder">
                        <option value="brewery">üè≠ Brewery Name</option>
                        <option value="beer">üç∫ Specific Beer</option>
                        <option value="style">üé® Beer Style</option>
                    </select>
                </div>
                <div class="beer-search-container">
                    <input type="text" class="form-input" placeholder="Start typing brewery name..." id="beerInput">
                    <div id="beerSuggestions" class="suggestions beer-search-suggestions"></div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" data-action="close-modal">Cancel</button>
                    <button class="btn btn-primary" data-action="search-beer">Search</button>
                </div>
            </div>
        </div>
    
        <!-- Distance Selection Modal -->
        <div id="distanceModal" class="search-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">üìç How far will you travel?</h3>
                </div>
                <div class="distance-options">
                    <div class="distance-option" data-distance="1">
                        <div class="distance-number">1km</div>
                        <div class="distance-label">Walking distance</div>
                    </div>
                    <div class="distance-option" data-distance="3">
                        <div class="distance-number">3km</div>
                        <div class="distance-label">Short journey</div>
                    </div>
                    <div class="distance-option popular" data-distance="5">
                        <div class="distance-number">5km</div>
                        <div class="distance-label">Most popular</div>
                    </div>
                    <div class="distance-option" data-distance="10">
                        <div class="distance-number">10km</div>
                        <div class="distance-label">Longer trip</div>
                    </div>
                    <div class="distance-option" data-distance="20">
                        <div class="distance-number">20km</div>
                        <div class="distance-label">Day out</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" data-action="close-modal">Cancel</button>
                </div>
            </div>
        </div>
    
        <!-- Results Overlay -->
        <div id="resultsOverlay" class="results-overlay">
            <div class="results-container">
                <div class="results-nav">
                    <button class="btn-nav-small" data-action="close-results">üè† Home</button>
<!--                     <h2 class="results-title" id="resultsTitle">Search Results</h2> -->

                    <div class="map-toggle-switch">
                        <div class="toggle-container" id="mapToggleContainer">
                            <div class="toggle-track">
                                <div class="toggle-thumb" id="toggleThumb"></div>
                                <div class="toggle-option active" data-value="gf">GF Pubs</div>
                                <div class="toggle-option" data-value="all">All Pubs</div>
                            </div>
                        </div>
                    </div>
                    
                    
                    <button class="btn-nav-small" data-action="toggle-results-map">üó∫Ô∏è <span id="resultsMapBtnText">Map</span></button>
                </div>
                
                <div class="results-content">
                    <div class="results-list-container" id="resultsListContainer">
                        <div class="results-loading" id="resultsLoading">
                            <div class="loading-spinner"></div>
                            <div class="loading-text">Finding nearby GF beer...</div>
                        </div>
                        
                        <div class="results-list" id="resultsList" style="display: none;"></div>
                        
                        <div class="no-results-found" id="noResultsFound" style="display: none;">
                            <div class="no-results-icon">üîç</div>
                            <div class="no-results-title">No pubs found</div>
                            <div class="no-results-text">Try expanding your search or check the spelling</div>
                            <div class="no-results-actions">
                                <button class="btn btn-primary" data-action="add-new-pub-from-results">‚ûï Add New Pub/Bar</button>
                                <button class="btn btn-secondary" data-action="search-google-places">üîç Search Google Maps</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="results-map-container" id="resultsMapContainer" style="display: none;">
                        <div id="resultsMap" class="results-map"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pub Details Overlay -->
        <!-- REPLACE the entire Pub Details Overlay section in index.html -->

        <!-- Pub Details Overlay -->
        <div id="pubDetailsOverlay" class="pub-details-overlay">
            <div class="pub-details-container">
                <!-- Purple navigation bar -->
                <div class="pub-details-nav">
                    <button class="btn-nav-small" data-action="close-pub-details">üè† Home</button>
                    <button class="btn-nav-small" data-action="back-to-results">‚Üê Back</button>
                </div>
                
                <!-- Main content card -->
                <div class="pub-details-card">
                    <div class="pub-details-content">
                        <div class="pub-header">
                            <h1 class="pub-title" id="pubDetailsTitle">Pub Name</h1>
                            <div class="pub-address" id="pubDetailsAddress">Address</div>
                            <div class="pub-location" id="pubDetailsLocation">Location</div>
                        </div>
        
                        <div class="gf-status-section">
                            <div class="status-card">
                                <h3 class="status-question">üç∫ What's the GF beer situation here?</h3>
                                <div class="current-status" id="currentGFStatus">
                                    <span class="status-icon">‚ùì</span>
                                    <span class="status-text">Not Sure</span>
                                    <span class="status-meta">Help us find out!</span>
                                </div>
                                <button class="btn btn-sm" data-action="change-gf-status">‚úèÔ∏è Change this</button>
                            </div>
                        </div>

                        <div class="beer-section">
                            <div class="beer-section-title">üç∫ Available Gluten Free Beers</div>
                            <div class="beer-status" id="pubDetailsBeer"></div>
                        </div>
                    </div>
                    
                    <!-- Action buttons stick to bottom -->
                    <div class="pub-action-grid">
                        <button class="btn btn-external" data-action="find-pub-online">üîç Find Online</button>
                        <button class="btn btn-external" data-action="get-pub-directions">üß≠ Get Directions</button>
                        <button class="btn btn-toggle" data-action="toggle-pub-map">üó∫Ô∏è <span id="pubMapBtnText">Show on Map</span></button>
                        <button class="btn btn-positive" data-action="report-beer">üìù Report GF Beer</button>
                    </div>
                </div>
                
                <!-- Map container for split view -->
                <div class="pub-map-container" id="pubMapContainer">
                    <div class="pub-map-placeholder">üó∫Ô∏è Interactive Map Loading...</div>
                </div>
            </div>
        </div>

        <!-- Report Modal -->
        <div id="reportModal" class="report-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">üì∏ Report GF Beer Find</h2>
                    <button class="modal-close" data-action="close-modal" aria-label="Close report modal">&times;</button>
                </div>
                
                <div class="modal-body">
                    <form id="reportForm" class="modal-form" data-action="submit-report">
                        <div class="form-group" id="pubSearchGroup">
                            <label class="form-label">Find Your Pub *</label>
                            <input type="text" id="reportPubSearch" class="form-input" placeholder="Start typing pub name..." autocomplete="off">
                            <div id="pubSuggestions" class="suggestions"></div>
                            <small style="color: var(--text-muted); font-size: 0.8rem;">Search for an existing pub first - we'll check our database!</small>
                        </div>
                        
                        <div id="selectedPubInfo" class="selected-pub-info" style="display: none;">
                            <div class="selected-pub-card">
                                <strong id="selectedPubName"></strong>
                                <div id="selectedPubAddress"></div>
                                <button type="button" class="btn btn-secondary btn-sm" data-action="clear-selected-pub">Choose Different Pub</button>
                            </div>
                        </div>
                        
                        <div id="newPubFields" class="new-pub-fields" style="display: none;">
                            <h4>üìç Add New Pub</h4>
                            <div class="form-group">
                                <label class="form-label">Pub Name *</label>
                                <input type="text" id="reportPubName" class="form-input" placeholder="The Red Lion">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Address *</label>
                                <input type="text" id="reportAddress" class="form-input" placeholder="123 High Street">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Postcode *</label>
                                <input type="text" id="reportPostcode" class="form-input" placeholder="SW1A 1AA">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Beer Format *</label>
                            <select id="reportFormat" name="reportFormat" class="form-select" required>
                                <option value="">Select format...</option>
                                <option value="bottle">üç∫ Bottle</option>
                                <option value="tap">üö∞ Tap</option>
                                <option value="cask">üõ¢Ô∏è Cask</option>
                                <option value="can">ü•´ Can</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Brewery</label>
                            <div class="brewery-dropdown-container">
                                <input type="text" id="reportBrewery" name="reportBrewery" class="form-input" placeholder="Start typing brewery name..." autocomplete="off">
                                <div id="breweryDropdown" class="suggestions brewery-suggestions"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Beer Name</label>
                            <div class="beer-name-container">
                                <input type="text" id="reportBeerName" name="reportBeerName" class="form-input" placeholder="Start typing beer name..." autocomplete="off">
                                <div id="beerNameDropdown" class="suggestions beer-suggestions"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Beer Style</label>
                            <div class="beer-style-container">
                                <input type="text" id="reportBeerStyle" name="reportBeerStyle" class="form-input" placeholder="IPA, Lager, Stout..." autocomplete="off">
                                <div id="beerStyleDropdown" class="suggestions style-suggestions"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ABV (Alcohol %)</label>
                            <input type="number" id="reportBeerABV" name="reportBeerABV" class="form-input" placeholder="4.5" step="0.1" min="0" max="20">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Photo (Optional)</label>
                            <label for="reportPhoto" class="photo-upload-compact">
                                <div class="photo-upload-icon">üì∑</div>
                                <div class="photo-upload-text">
                                    <strong>Add a photo</strong><br>
                                    <small>Beer menu, bottle, or tap</small>
                                </div>
                                <input type="file" id="reportPhoto" name="reportPhoto" accept="image/*" style="display: none;">
                            </label>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" data-action="close-modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Submit Report</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Other Modals -->
        <div id="placesSearchModal" class="modal places-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">üîç Find Your Venue</h2>
                    <button class="modal-close" data-action="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="search-prompt">Search for bars, pubs, or restaurants:</p>
                    <div class="places-search-container">
                        <input type="text" id="placesSearchInput" class="form-input" placeholder="e.g. Lawn Club Sheffield" autocomplete="off">
                        <div id="placesResults" class="places-results"></div>
                    </div>
                    <div class="search-powered-by"><small>Powered by OpenStreetMap</small></div>
                    <div id="selectedPlacePreview" class="selected-place-preview" style="display: none;">
                        <h4>Selected Venue:</h4>
                        <div class="place-details">
                            <strong id="selectedPlaceName"></strong>
                            <div id="selectedPlaceAddress"></div>
                            <div id="selectedPlaceType"></div>
                        </div>
                        <button class="btn btn-primary" data-action="use-selected-place">‚úÖ Use This Venue</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="pubAddedPromptModal" class="modal prompt-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-body" style="text-align: center;">
                    <div class="success-icon" style="font-size: 4rem; margin-bottom: 20px;">üéâ</div>
                    <h3 style="margin-bottom: 10px;">Pub Added Successfully!</h3>
                    <p style="margin-bottom: 20px;"><strong id="addedPubName"></strong> has been added to our database.</p>
                    <p style="margin-bottom: 30px;">What would you like to do next?</p>
                    <div class="modal-actions" style="display: flex; flex-direction: column; gap: 12px;">
                        <button class="btn btn-primary" data-action="update-gf-status-new-pub">üìä Update GF Beer Status</button>
                        <button class="btn btn-success" data-action="report-gf-beer-new-pub">üç∫ Report GF Beer Available</button>
                        <button class="btn btn-secondary" data-action="close-pub-added-modal">‚úÖ Done For Now</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Modals -->
        <div id="gfStatusModal" class="modal status-modal">
            <div class="modal-content status-modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Update GF Beer Status</h2>
                    <button class="modal-close" data-action="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="status-prompt">Select the current GF beer situation at <strong id="statusPubName">this pub</strong>:</p>
                    <div class="status-options">
                        <button class="status-option always" data-status="always">
                            <div class="option-icon">‚≠ê</div>
                            <div class="option-content">
                                <h4>Always Available</h4>
                                <p>This pub always has GF beer on the menu</p>
                            </div>
                        </button>
                        <button class="status-option currently" data-status="currently">
                            <div class="option-icon">‚úÖ</div>
                            <div class="option-content">
                                <h4>Available Now</h4>
                                <p>GF beer is currently in stock</p>
                            </div>
                        </button>
                        <button class="status-option not-currently" data-status="not_currently">
                            <div class="option-icon">‚ùå</div>
                            <div class="option-content">
                                <h4>Not Available</h4>
                                <p>No GF options right now</p>
                            </div>
                        </button>
                        <button class="status-option unknown" data-status="unknown">
                            <div class="option-icon">‚ùì</div>
                            <div class="option-content">
                                <h4>Not Sure</h4>
                                <p>Status unknown</p>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="gfStatusConfirmModal" class="modal confirm-modal">
            <div class="modal-content confirm-modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Confirm Status Change</h2>
                </div>
                <div class="modal-body">
                    <div class="confirm-message">
                        <p>You're about to update the GF beer status to:</p>
                        <div class="confirm-status" id="confirmStatus"></div>
                        <p class="confirm-warning">This will be visible to all users. Are you sure?</p>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-secondary" data-action="cancel-status">Cancel</button>
                        <button class="btn btn-primary" data-action="confirm-status">Yes, Update</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="beerDetailsPromptModal" class="modal prompt-modal">
            <div class="modal-content prompt-modal-content">
                <div class="modal-body">
                    <div class="success-icon">üéâ</div>
                    <h3>Thanks for the update!</h3>
                    <p>Would you like to tell us which GF beers are available?</p>
                    <div class="modal-actions">
                        <button class="btn btn-secondary" data-action="skip-details">Not Now</button>
                        <button class="btn btn-primary" data-action="add-beer-details">üìù Add Beer Details</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Modals -->
        <div id="aboutModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">‚ÑπÔ∏è About Coeliacs Like Beer Too</h2>
                    <button class="modal-close" aria-label="Close about modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="about-content">
                        <div class="about-section">
                            <h3>üç∫ Our Mission</h3>
                            <p>We believe that being coeliac shouldn't mean missing out on great beer experiences. Our mission is to create the UK's most comprehensive, community-driven guide to gluten free beer options across the country.</p>
                        </div>
                        <div class="about-section">
                            <h3>üë• Our Story</h3>
                            <p>Started by coeliacs, for coeliacs. We understand the frustration of walking into a pub and not knowing if they have any safe options. That's why we built this platform - to help our community find amazing gluten free beer wherever they are in the UK.</p>
                        </div>
                        <div class="about-section">
                            <h3>ü§ù Community Driven</h3>
                            <p>Every beer report, every pub update, every photo comes from real people in the coeliac community. Together, we're building something that helps everyone discover new places and feel confident about their choices.</p>
                        </div>
                        <div class="about-section">
                            <h3>üìà Growing Together</h3>
                            <p>With thousands of pubs in our database and growing reports every day, we're becoming the go-to resource for gluten free beer discovery. Join us in making the UK more accessible for coeliacs!</p>
                        </div>
                        <div class="contact-info">
                            <h3>üí¨ Get in Touch</h3>
                            <p>Questions, suggestions, or partnership opportunities? We'd love to hear from you!</p>
                            <button data-action="coming-soon" data-feature="Contact Form" class="btn btn-primary">Contact Us</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="gfInfoModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">üî¨ What is Gluten Free Beer?</h2>
                    <button data-action="close-modal" aria-label="Close GF info modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="gf-content">
                        <div class="gf-section">
                            <h3>üß™ Official Standards</h3>
                            <div class="standards-grid">
                                <div class="standard-item">
                                    <strong>üá¨üáß UK & EU</strong>
                                    <p>Less than 20ppm gluten</p>
                                </div>
                                <div class="standard-item">
                                    <strong>üá∫üá∏ USA</strong>
                                    <p>Made only with gluten free ingredients</p>
                                </div>
                                <div class="standard-item">
                                    <strong>üá¶üá∫ Australia</strong>
                                    <p>Made only with gluten free ingredients</p>
                                </div>
                            </div>
                        </div>
                        <div class="gf-section">
                            <h3>üè∑Ô∏è Types of GF Beer</h3>
                            <div class="beer-types">
                                <div class="beer-type-item">
                                    <strong>‚úÖ Certified Gluten Free</strong>
                                    <p>Made from naturally gluten free grains (rice, sorghum, millet). Safest option.</p>
                                </div>
                                <div class="beer-type-item">
                                    <strong>‚öóÔ∏è Gluten Removed/Reduced</strong>
                                    <p>Made from barley/wheat but treated with enzymes to break down gluten. Some coeliacs react.</p>
                                </div>
                                <div class="beer-type-item">
                                    <strong>üåæ "Made Without Gluten"</strong>
                                    <p>No gluten ingredients added, but may have cross-contamination. Check carefully!</p>
                                </div>
                            </div>
                        </div>
                        <div class="gf-section">
                            <h3>‚ö†Ô∏è Important Notes</h3>
                            <ul class="safety-notes">
                                <li><strong>Cross-contamination</strong> can happen in breweries that also make regular beer</li>
                                <li><strong>Always check labels</strong> and ask staff about preparation methods</li>
                                <li><strong>Coeliacs vs Gluten Intolerant</strong> - Coeliac disease is an autoimmune condition requiring strict gluten avoidance, while gluten intolerance is a separate digestive sensitivity</li>
                                <li><strong>When in doubt</strong>, choose certified gluten free options</li>
                            </ul>
                        </div>
                        <div class="disclaimer">
                            <p><strong>Disclaimer:</strong> This information is for guidance only. Always consult with healthcare professionals and verify product safety for your individual needs.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Map Overlay -->
        <div id="fullMapOverlay" class="map-overlay">
            <div class="map-container">
                <div class="map-nav">
                    <button class="btn-nav-small" data-action="close-full-map">üè† Home</button>

                    <div class="map-toggle-switch">
                        <div class="toggle-container" id="mapToggleContainer">
                            <div class="toggle-track">
                                <div class="toggle-thumb" id="toggleThumb"></div>
                                <div class="toggle-option active" data-value="gf">GF Pubs</div>
                                <div class="toggle-option" data-value="all">All Pubs</div>
                            </div>
                        </div>
                    </div>

                    <button class="btn-nav-small" data-action="go-to-my-location">üìç My Location</button>
                </div>
                <div class="map-overlay-content">
                    <div id="fullMap" class="full-map"></div>
                </div>
            </div>
        </div>

        <!-- ADD this to index.html after the other modals (before the Toasts section) -->

        <!-- Location Permission Modal -->
        <div id="locationPermissionModal" class="modal location-modal" style="display: none;">
            <div class="modal-content location-permission-card">
                <div class="permission-icon">üìç</div>
                <h2 class="permission-title">Enable Location Services</h2>
                <p class="permission-text">
                    To find pubs near you, we need access to your location. 
                    Your location data stays on your device and is never stored.
                </p>
                <div class="permission-benefits">
                    <div class="benefit-item">
                        <span class="benefit-icon">üéØ</span>
                        <span>Find the closest pubs with GF beer</span>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">üìè</span>
                        <span>See accurate distances</span>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">üó∫Ô∏è</span>
                        <span>Get directions from your location</span>
                    </div>
                </div>
                <div class="permission-actions">
                    <button class="btn btn-secondary" data-action="deny-location">Not Now</button>
                    <button class="btn btn-primary" data-action="allow-location">Enable Location</button>
                </div>
                <p class="permission-note">
                    You can change this anytime in your browser settings
                </p>
            </div>
        </div>

        <!-- ADD this modal after the locationPermissionModal in index.html -->

        <!-- Location Blocked Modal -->
        <div id="locationBlockedModal" class="modal location-modal">
            <div class="modal-content location-permission-card">
                <div class="permission-icon blocked">üö´</div>
                <h2 class="permission-title">Location Access Blocked</h2>
                <p class="permission-text">
                    Your browser is currently blocking location access for this website. 
                    To find pubs near you, you'll need to update your browser settings.
                    If you don't wish to share your location, please select "Search
                    by Area" below to continue.
                </p>
                
                <div class="permission-benefits blocked-instructions">
                    <h4>How to enable location:</h4>
                    
                    <div class="browser-instructions" id="browserInstructions">
                        <!-- Chrome -->
                        <div class="instruction-set" data-browser="chrome">
                            <strong>Chrome:</strong>
                            <ol>
                                <li>Click the lock icon üîí in the address bar</li>
                                <li>Find "Location" and change it to "Allow"</li>
                                <li>Refresh the page and try again</li>
                            </ol>
                        </div>
                        
                        <!-- Firefox -->
                        <div class="instruction-set" data-browser="firefox">
                            <strong>Firefox:</strong>
                            <ol>
                                <li>Click the lock icon üîí in the address bar</li>
                                <li>Click "Clear permissions and reload"</li>
                                <li>When prompted, click "Allow location access"</li>
                            </ol>
                        </div>
                        
                        <!-- Safari -->
                        <div class="instruction-set" data-browser="safari">
                            <strong>Safari:</strong>
                            <ol>
                                <li>Go to Safari ‚Üí Preferences ‚Üí Websites</li>
                                <li>Click "Location" in the sidebar</li>
                                <li>Find coeliacslikebeer.co.uk and change to "Allow"</li>
                            </ol>
                        </div>
                        
                        <!-- Edge -->
                        <div class="instruction-set" data-browser="edge">
                            <strong>Edge:</strong>
                            <ol>
                                <li>Click the lock icon üîí in the address bar</li>
                                <li>Click "Permissions for this site"</li>
                                <li>Find "Location" and change to "Allow"</li>
                            </ol>
                        </div>
                        
                        <!-- Generic -->
                        <div class="instruction-set" data-browser="generic">
                            <strong>Most browsers:</strong>
                            <ol>
                                <li>Look for a lock icon üîí in your address bar</li>
                                <li>Click it and find location settings</li>
                                <li>Change location access to "Allow"</li>
                                <li>Refresh the page and try again</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <div class="permission-actions">
                    <button class="btn btn-secondary" data-action="close-location-blocked">Search by Area</button>
                    <button class="btn btn-primary" data-action="reload-page">Try Again</button>
                </div>
                
                <p class="permission-note">
                    Don't worry - your location data is never stored or shared
                </p>
            </div>
        </div>
        
        <!-- Toasts -->
        <div id="loadingToast" class="toast toast-loading" style="display: none;">
            <div class="toast-content">
                <div class="spinner"></div>
                <span id="loadingMessage">Loading...</span>
            </div>
        </div>
        
        <div id="successToast" class="toast toast-success" style="display: none;">
            <div class="toast-content">
                <span class="toast-icon">‚úÖ</span>
                <span id="successMessage">Success!</span>
            </div>
        </div>
        
        <!-- Cookie Consent -->
        <div id="cookieConsent" class="cookie-consent" style="display: none;">
            <div class="cookie-content">
                <div class="cookie-text">
                    <h4>üç™ We use cookies</h4>
                    <p>We use essential cookies to make our site work. With your consent, we may also use analytics cookies to improve your experience.</p>
                </div>
                <div class="cookie-buttons">
                    <button data-action="accept-all-cookies" class="cookie-btn cookie-btn-accept">Accept All</button>
                    <button data-action="accept-essential-cookies" class="cookie-btn cookie-btn-essential">Essential Only</button>
                    <button data-modal="cookieSettings" class="cookie-btn cookie-btn-settings">Settings</button>
                </div>
            </div>
        </div>
        
        <div id="cookieSettings" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">üç™ Cookie Settings</h2>
                    <button class="modal-close" aria-label="Close cookie settings">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="cookie-settings-content">
                        <div class="cookie-category">
                            <div class="cookie-category-header">
                                <h3>Essential Cookies</h3>
                                <label class="cookie-toggle">
                                    <input type="checkbox" checked disabled>
                                    <span class="toggle-slider essential"></span>
                                </label>
                            </div>
                            <p>These cookies are necessary for the website to function and cannot be switched off. They are usually only set in response to actions made by you which amount to a request for services.</p>
                            <div class="cookie-details">
                                <strong>Examples:</strong> Session management, search preferences, location consent
                            </div>
                        </div>
                        <div class="cookie-category">
                            <div class="cookie-category-header">
                                <h3>Analytics Cookies</h3>
                                <label class="cookie-toggle">
                                    <input type="checkbox" id="analyticsConsent">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <p>These cookies help us understand how visitors interact with our website by collecting and reporting information anonymously. This helps us improve our service.</p>
                            <div class="cookie-details">
                                <strong>Provider:</strong> Google Analytics<br>
                                <strong>Purpose:</strong> Usage statistics, popular features, performance monitoring
                            </div>
                        </div>
                        <div class="cookie-info">
                            <h4>üìã Your Rights</h4>
                            <ul>
                                <li>You can change your preferences at any time</li>
                                <li>Withdrawing consent may limit website functionality</li>
                                <li>Essential cookies cannot be disabled</li>
                                <li>See our <a href="/cookies" target="_blank">Cookie Policy</a> for full details</li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button data-action="save-cookie-preferences" class="btn btn-primary">Save Preferences</button>
                        <button data-action="accept-all-from-settings" class="btn btn-success">Accept All</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="cookieSettingsFloat" class="cookie-settings-float" style="display: none;">
            <button data-action="show-cookie-settings" class="cookie-float-btn" title="Cookie Settings">üç™</button>
        </div>

        <!-- Templates -->
        <template id="pub-result-template">
            <div class="result-item">
                <div class="result-header">
                    <div class="result-main-info">
                        <h3 class="result-title"></h3>
                        <div class="result-distance"></div>
                    </div>
                    <div class="gf-indicator"></div>
                </div>
                <div class="result-location">
                    <div class="result-address"></div>
                    <div class="result-postcode"></div>
                    <div class="result-authority"></div>
                </div>
                <div class="result-actions">
                    <button class="btn btn-primary" data-action="view-pub">üìç View Details</button>
                </div>
            </div>
        </template>

        <template id="map-legend-template">
            <div class="map-legend">
                <div class="legend-title">üç∫ GF Beer Status</div>
                <div class="legend-item">
                    <div class="legend-marker always-gf"></div>
                    <span class="legend-text">Always Has GF Beer</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker current-gf"></div>
                    <span class="legend-text">Currently Has GF Beer</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker no-gf"></div>
                    <span class="legend-text">No GF Currently</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker unknown"></div>
                    <span class="legend-text">Unknown Status</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker user-location"></div>
                    <span class="legend-text">Your Location</span>
                </div>
            </div>
        </template>
        
        <template id="map-error-template">
            <div class="map-error-container">
                <div class="map-error-icon">üìç</div>
                <div class="map-error-title">Location coordinates not available</div>
                <div class="map-error-text">Help us by reporting the exact location!</div>
            </div>
        </template>
        
        <template id="popup-content-template">
            <div class="popup-content">
                <div class="popup-title" data-field="name"></div>
                <div class="popup-address" data-field="address"></div>
                <div class="popup-postcode" data-field="postcode"></div>
                <div class="popup-distance" data-field="distance" style="display: none;"></div>
                <div class="popup-gf-status" data-field="gf-status"></div>
                <button class="popup-button" data-action="view-details">View Details</button>
            </div>
        </template>
        
        <!-- Scripts -->
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
        <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
        <script type="module" src="/static/js/main.js?v={{ cache_buster }}"></script>
        
        <script>
            // Essential initialization
            document.addEventListener('DOMContentLoaded', function() {
                console.log('üîß Setting up legacy event handlers...');
                
                // Check app initialization
                setTimeout(() => {
                    if (!window.CoeliacsApp?.initialized) {
                        console.warn('‚ö†Ô∏è App initialization may have failed');
                    }
                }, 3000);
                
                // Photo upload handler
                const photoInput = document.getElementById('reportPhoto');
                const photoLabel = document.querySelector('.photo-upload-compact');
                
                if (photoInput && photoLabel) {
                    photoInput.addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            const fileName = file.name.length > 20 ? 
                                file.name.substring(0, 17) + '...' : 
                                file.name;
                            
                            const textEl = photoLabel.querySelector('.photo-upload-text');
                            if (textEl) {
                                textEl.innerHTML = `<strong>üì∏ ${fileName}</strong><br><small>Click to change photo</small>`;
                            }
                            photoLabel.classList.add('active');
                        }
                    });
                }
            });
            
            // Performance monitoring
            window.addEventListener('load', function() {
                if (performance && performance.timing) {
                    setTimeout(() => {
                        const timing = performance.timing;
                        if (timing.loadEventEnd > 0 && timing.navigationStart > 0) {
                            const loadTime = timing.loadEventEnd - timing.navigationStart;
                            if (loadTime > 0 && loadTime < 60000) {
                                console.log(`‚ö° Page load time: ${loadTime}ms`);
                            }
                        }
                    }, 100);
                }
            });
            
            // Cache buster logging
            console.log('üöÄ CACHE BUSTER:', '{{ cache_buster }}');
            console.log('üì± User Agent:', navigator.userAgent.substring(0, 50) + '...');
            console.log('üì∫ Viewport:', window.innerWidth + 'x' + window.innerHeight);
            console.log('üåê Connection:', navigator.connection?.effectiveType || 'unknown');
        </script>
    </body>
</html>
