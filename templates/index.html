<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coeliacs Like Beer Too! - Find GF-Friendly Pubs - {{ cache_buster }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v={{ cache_buster }}">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
    <!------------------------------------------->
    <!-- Google Analytics with GDPR compliance -->
    <!------------------------------------------->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WSHR39KSXS"></script>
    
    <!--------------------------->
    <!-- Basic analytics setup -->
    <!--------------------------->
    
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        
        // Set default consent to denied (GDPR compliant)
        gtag('consent', 'default', {
            'analytics_storage': 'denied'
        });
        
        gtag('js', new Date());
        gtag('config', 'G-WSHR39KSXS', {
            'anonymize_ip': true,
            'cookie_flags': 'SameSite=None;Secure'
        });
    </script>
    
    <!----------------------->
    <!-- HTML hero section -->
    <!----------------------->
    
    <div class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">Coeliacs Like Beer Too!</h1>
            <p class="hero-subtitle">The UK's largest community-driven guide to gluten free beer</p>
            
            <div class="hero-stats">
                <div class="stat-item">
                    <span class="stat-number" id="totalPubs">Loading...</span>
                    <span class="stat-label">Pubs in the UK</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="gfPubs">Loading...</span>
                    <span class="stat-label">Serving GF Beer</span>
                </div>
            </div>
        </div>
    </div>

    <!------------------------->
    <!-- HTML search section -->
    <!------------------------->
    
    <div class="search-section" id="search">
        <div class="container">
            <div class="search-card">
                <div class="search-header">
                    <h2 class="section-title">üîç What are you searching for? üç∫</h2>
                </div>
                <div class="search-body">
                    <div class="search-options">
                        <!-- Top Left: Pubs Near Me -->
                        <div class="search-option name" data-action="location-search">
                            <span class="search-icon">üìç</span>
                            <h3 class="search-title">Pubs Near Me</h3>
                            <p class="search-description">Find pubs close to you, control the search distance.</p>
                        </div>
                        <!-- Top Right: Pubs by Name -->      
                        <div class="search-option location" data-modal="nameModal">
                            <span class="search-icon">üè†</span>
                            <h3 class="search-title">Pubs by Name</h3>
                            <p class="search-description">Search for a specific pub name - "Milestone" etc</p>
                        </div>
                        <!-- Bottom Left: Pubs by Area -->
                        <div class="search-option area" data-modal="areaModal">
                            <span class="search-icon">üó∫Ô∏è</span>
                            <h3 class="search-title">Pubs by Area</h3>
                            <p class="search-description">Explore pubs in regions, cities, or postcodes</p>
                        </div>
                        <!-- Bottom Right: Pubs by Beer -->
                        <div class="search-option beer" data-modal="beerModal">
                            <span class="search-icon">üç∫</span>
                            <h3 class="search-title">Pubs by Beer</h3>
                            <p class="search-description">Find pubs serving specific GF beers - "Zapato", "IPA" etc.</p>
                        </div>            
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!------------------------------->
    <!-- HTML search modal section -->
    <!------------------------------->
    
    <div id="nameModal" class="search-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üè† Search by Pub Name</h3>
                <p class="modal-subtitle">Enter the name of the pub you're looking for</p>
            </div>
            <input type="text" class="form-input" placeholder="e.g. The Red Lion, Wetherspoons" id="nameInput">
            <div class="modal-actions">
                <button class="btn btn-secondary" data-action="close-modal">Cancel</button>
                <button class="btn btn-primary" data-action="search-name">Search</button>
            </div>
        </div>
    </div>
    
    <div id="areaModal" class="search-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üó∫Ô∏è Search by Area</h3>
                <p class="modal-subtitle">Find pubs in a specific location</p>
            </div>
            
            <!-- Search Type Selector -->
            <div class="form-group">
                <label class="form-label">Search by:</label>
                <select id="areaSearchType" class="form-select" data-action="update-area-placeholder">
                    <option value="postcode">üìÆ Postcode</option>
                    <option value="city">üèôÔ∏è City/Region</option>
                </select>
            </div>
            
            <!-- Search Input -->
            <input type="text" class="form-input" placeholder="Enter postcode..." id="areaInput">
            
            <div class="modal-actions">
                <button class="btn btn-secondary" data-action="close-modal">Cancel</button>
                <button class="btn btn-primary" data-action="search-area">Search</button>
            </div>
        </div>
    </div>

    <div id="beerModal" class="search-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üç∫ Search by Beer</h3>
                <p class="modal-subtitle">Find pubs serving specific gluten-free beers</p>
            </div>
            
            <!-- Search Type Selector -->
            <div class="form-group">
                <label class="form-label">Search by:</label>
                <select id="beerSearchType" class="form-select" data-action="update-beer-placeholder">
                    <option value="brewery">üè≠ Brewery Name</option>
                    <option value="beer">üç∫ Specific Beer</option>
                    <option value="style">üé® Beer Style</option>
                </select>
            </div>
            
            <!-- Search Input with Autocomplete -->
            <div class="beer-search-container">
                <input type="text" class="form-input" placeholder="Start typing brewery name..." id="beerInput">
                <div id="beerSuggestions" class="suggestions beer-search-suggestions"></div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" data-action="close-modal">Cancel</button>
                <button class="btn btn-primary" data-action="search-beer">Search</button>
            </div>
        </div>
    </div>

    <!-- Distance Selection Modal -->
    <div id="distanceModal" class="search-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üìç How far will you travel?</h3>
            </div>
           
            <div class="distance-options">
                <div class="distance-option" data-distance="1">
                    <div class="distance-number">1km</div>
                    <div class="distance-label">Walking distance</div>
                </div>
                <div class="distance-option" data-distance="3">
                    <div class="distance-number">3km</div>
                    <div class="distance-label">Short journey</div>
                </div>
                <div class="distance-option" data-distance="5">
                    <div class="distance-number">5km</div>
                    <div class="distance-label">Most popular</div>
                </div>
                <div class="distance-option" data-distance="10">
                    <div class="distance-number">10km</div>
                    <div class="distance-label">Longer trip</div>
                </div>
                <div class="distance-option" data-distance="20">
                    <div class="distance-number">20km</div>
                    <div class="distance-label">Day out</div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" data-action="close-modal">Cancel</button>
            </div>
        </div>
    </div>

    <!---------------------------------------------->
    <!-- HTML full screen results overlay section -->
    <!---------------------------------------------->
    <div id="resultsOverlay" class="results-overlay">
        <div class="results-container">
            <!-- Results Header -->
            <div class="results-nav">
                <button class="btn-nav-small" data-action="close-results">
                    üè† Home
                </button>
                <h2 class="results-title" id="resultsTitle">Search Results</h2>
                <button class="btn-nav-small" data-action="toggle-results-map">
                    üó∫Ô∏è <span id="resultsMapBtnText">Map</span>
                </button>
            </div>
            
            <!-- Results Content -->
            <div class="results-content">
                <div class="results-list-container" id="resultsListContainer">
                    <!-- Loading state -->
                    <div class="results-loading" id="resultsLoading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Finding nearby GF beer...</div>
                    </div>
                    
                    <!-- Results list -->
                    <div class="results-list" id="resultsList" style="display: none;">
                        <!-- Results will be populated here -->
                    </div>
                    
                    <!-- No results -->
                    <div class="no-results-found" id="noResultsFound" style="display: none;">
                        <div class="no-results-icon">üîç</div>
                        <div class="no-results-title">No pubs found</div>
                        <div class="no-results-text">Try expanding your search distance or removing filters</div>
                    </div>
                </div>
                
                <!-- Results Map (hidden by default) -->
                <div class="results-map-container" id="resultsMapContainer" style="display: none;">
                    <div id="resultsMap" class="results-map"></div>
                </div>
            </div>
        </div>
    </div>

    <!-------------------------------------------------->
    <!-- HTML full screen pub details overlay section -->
    <!-------------------------------------------------->
    <div id="pubDetailsOverlay" class="pub-details-overlay">
        <div class="pub-details-container" id="pubContainer">
            <div class="pub-details-card">
                <!-- NEW: Top navigation - ADD THIS -->
                <div class="pub-nav-top">
                    <button class="btn-nav-small" data-action="close-pub-details">
                        üè† Home
                    </button>
                    <button class="btn-nav-small" data-action="back-to-results" type="button">
                        ‚Üê Back
                    </button>
                </div>
    
                <div class="pub-header">
                    <h1 class="pub-title" id="pubDetailsTitle">Pub Name</h1>
                    <div class="pub-address" id="pubDetailsAddress">Address</div>
                    <div class="pub-location" id="pubDetailsLocation">Location</div>
                </div>
    
                <div class="beer-section">
                    <div class="beer-section-title">
                        üç∫ Available Gluten Free Beers
                    </div>
                    <div class="beer-status" id="pubDetailsBeer">
                        Loading beer information...
                    </div>
                </div>
    
                <div class="pub-action-grid">
                    <button class="btn btn-external" id="pubFindOnline">
                        üîç Find Online
                    </button>
                    <button class="btn btn-external" id="pubGetDirections">
                        üß≠ Get Directions
                    </button>
                    <button class="btn btn-toggle" id="pubToggleMap" data-action="toggle-pub-map">
                        üó∫Ô∏è <span id="pubMapBtnText">Show on Map</span>
                    </button>
                    <b<button class="btn btn-positive" data-action="report-beer">
                        üìù Report GF Beer
                    </button>
                </div>
            </div>
    
            <div class="pub-map-container" id="pubMapContainer">
                <div class="pub-map-placeholder">
                    üó∫Ô∏è Interactive Map Loading...
                </div>
            </div>
        </div>
    </div>

    <!-- Dynamic Results Section - Pushed down when visible -->
    <div id="results-section" style="display: none;">
        <div class="results-header">
            <h2 class="section-title">üìç Search Results</h2>
        </div>
        <ul id="results" class="results-list"></ul>
    </div>

    <!-- Map Section (Hidden by Default, Smart Show) -->
    <div class="map-container" id="mapContainer" style="display: none;">
        <div class="map-section-header">
            <h2 class="section-title">üó∫Ô∏è Interactive Map</h2>
        </div>
        <div id="map"></div>
    </div>

    <!-- Location Status -->
    <div id="locationStatus" class="location-status location-loading" style="display: none;">
        Finding your location...
    </div>
    
    <!-- About Us Modal - UPDATED -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚ÑπÔ∏è About Coeliacs Like Beer Too</h2>
                <button class="modal-close" aria-label="Close about modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="about-content">
                    <div class="about-section">
                        <h3>üç∫ Our Mission</h3>
                        <p>We believe that being coeliac shouldn't mean missing out on great beer experiences. Our mission is to create the UK's most comprehensive, community-driven guide to gluten free beer options across the country.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>üë• Our Story</h3>
                        <p>Started by coeliacs, for coeliacs. We understand the frustration of walking into a pub and not knowing if they have any safe options. That's why we built this platform - to help our community find amazing gluten free beer wherever they are in the UK.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>ü§ù Community Driven</h3>
                        <p>Every beer report, every pub update, every photo comes from real people in the coeliac community. Together, we're building something that helps everyone discover new places and feel confident about their choices.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>üìà Growing Together</h3>
                        <p>With thousands of pubs in our database and growing reports every day, we're becoming the go-to resource for gluten free beer discovery. Join us in making the UK more accessible for coeliacs!</p>
                    </div>
                    
                    <div class="contact-info">
                        <h3>üí¨ Get in Touch</h3>
                        <p>Questions, suggestions, or partnership opportunities? We'd love to hear from you!</p>
                        <button data-action="coming-soon" data-feature="Contact Form" class="btn btn-primary">Contact Us</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- GF Info Modal - UPDATED -->
    <div id="gfInfoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üî¨ What is Gluten Free Beer?</h2>
                <button class="modal-close" onclick="closeModal('gfInfoModal')" aria-label="Close GF info modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="gf-content">
                    <div class="gf-section">
                        <h3>üß™ Official Standards</h3>
                        <div class="standards-grid">
                            <div class="standard-item">
                                <strong>üá¨üáß UK & EU</strong>
                                <p>Less than 20ppm gluten</p>
                            </div>
                            <div class="standard-item">
                                <strong>üá∫üá∏ USA</strong>
                                <p>Made only with gluten free ingredients</p>
                            </div>
                            <div class="standard-item">
                                <strong>üá¶üá∫ Australia</strong>
                                <p>Made only with gluten free ingredients</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="gf-section">
                        <h3>üè∑Ô∏è Types of GF Beer</h3>
                        <div class="beer-types">
                            <div class="beer-type-item">
                                <strong>‚úÖ Certified Gluten Free</strong>
                                <p>Made from naturally gluten free grains (rice, sorghum, millet). Safest option.</p>
                            </div>
                            <div class="beer-type-item">
                                <strong>‚öóÔ∏è Gluten Removed/Reduced</strong>
                                <p>Made from barley/wheat but treated with enzymes to break down gluten. Some coeliacs react.</p>
                            </div>
                            <div class="beer-type-item">
                                <strong>üåæ "Made Without Gluten"</strong>
                                <p>No gluten ingredients added, but may have cross-contamination. Check carefully!</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="gf-section">
                        <h3>‚ö†Ô∏è Important Notes</h3>
                        <ul class="safety-notes">
                            <li><strong>Cross-contamination</strong> can happen in breweries that also make regular beer</li>
                            <li><strong>Always check labels</strong> and ask staff about preparation methods</li>
                            <li><strong>Coeliacs vs Gluten Intolerant</strong> - Coeliac disease is an autoimmune condition requiring strict gluten avoidance, while gluten intolerance is a separate digestive sensitivity</li>
                            <li><strong>When in doubt</strong>, choose certified gluten free options</li>
                        </ul>
                    </div>
                    
                    <div class="disclaimer">
                        <p><strong>Disclaimer:</strong> This information is for guidance only. Always consult with healthcare professionals and verify product safety for your individual needs.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Smart Coordinate Modal - UPDATED -->
    <div id="coordinateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalPubName">Help us locate this pub!</h2>
                <button class="modal-close" onclick="closeModal('coordinateModal')" aria-label="Close coordinate modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <p>We'll search near the postcode and you can click to pinpoint the exact location.</p>
                
                <div class="modal-instructions">
                    <span id="modalInstructions">üó∫Ô∏è Searching for the pub area...</span>
                </div>
                
                <div id="coordinateMap" class="modal-map"></div>
                
                <div id="selectedLocationInfo" class="selected-location" style="display: none;">
                    <div>üìç Selected location:</div>
                    <div class="coordinates" id="selectedCoordinates"></div>
                </div>
                
                <div class="form-actions">
                    <button id="confirmLocation" class="btn btn-success">
                        ‚úÖ Confirm Location
                    </button>
                    <button id="cancelModal" class="btn btn-secondary" onclick="closeModal('coordinateModal')">
                        ‚ùå Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ================================
     REPORT MODAL HTML
     üîß ACTION: ADD this entire modal to templates/index.html
     üìç LOCATION: Add after your existing modals (after aboutModal, gfInfoModal, etc.)
     üìù NOTE: This should go BEFORE the bottom navigation bar
     ================================ -->

    <div id="reportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì∏ Report GF Beer Find</h2>
                <button class="modal-close" onclick="closeModal('reportModal')" aria-label="Close report modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="reportForm" class="modal-form" data-action="submit-report">
                    
                    <!-- Pub Search Field (hidden when pre-populated) -->
                    <div class="form-group" id="pubSearchGroup">
                        <label class="form-label">Find Your Pub *</label>
                        <input type="text" id="reportPubSearch" class="form-input" 
                               placeholder="Start typing pub name..." autocomplete="off">
                        <div id="pubSuggestions" class="suggestions"></div>
                        <small style="color: var(--text-muted); font-size: 0.8rem;">
                            Search for an existing pub first - we'll check our database!
                        </small>
                    </div>
                    
                    <!-- Selected Pub Info (shown when pub selected) -->
                    <div id="selectedPubInfo" class="selected-pub-info" style="display: none;">
                        <div class="selected-pub-card">
                            <strong id="selectedPubName"></strong>
                            <div id="selectedPubAddress"></div>
                            <button type="button" onclick="clearSelectedPub()" class="btn btn-secondary btn-sm">
                                Choose Different Pub
                            </button>
                        </div>
                    </div>
                    
                    <!-- New Pub Fields (shown when adding new pub) -->
                    <div id="newPubFields" class="new-pub-fields" style="display: none;">
                        <h4>üìç Add New Pub</h4>
                        <div class="form-group">
                            <label class="form-label">Pub Name *</label>
                            <input type="text" id="reportPubName" class="form-input" placeholder="The Red Lion">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Address *</label>
                            <input type="text" id="reportAddress" class="form-input" placeholder="123 High Street">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Postcode *</label>
                            <input type="text" id="reportPostcode" class="form-input" placeholder="SW1A 1AA">
                        </div>
                    </div>
                    
                    <!-- Beer Format (Required) -->
                    <div class="form-group">
                        <label class="form-label">Beer Format *</label>
                        <select id="reportFormat" name="reportFormat" class="form-select" required>
                            <option value="">Select format...</option>
                            <option value="bottle">üç∫ Bottle</option>
                            <option value="tap">üö∞ Tap</option>
                            <option value="cask">üõ¢Ô∏è Cask</option>
                            <option value="can">ü•´ Can</option>
                        </select>
                    </div>
                    
                    <!-- Brewery (Dropdown with search) -->
                    <div class="form-group">
                        <label class="form-label">Brewery</label>
                        <div class="brewery-dropdown-container">
                            <input type="text" id="reportBrewery" name="reportBrewery" class="form-input" 
                                   placeholder="Start typing brewery name..." 
                                   autocomplete="off" data-action="search-breweries">
                            <div id="breweryDropdown" class="suggestions brewery-suggestions"></div>
                        </div>
                    </div>
                    
                    <!-- Beer Name (Auto-complete based on brewery) -->
                    <div class="form-group">
                        <label class="form-label">Beer Name</label>
                        <div class="beer-name-container">
                            <input type="text" id="reportBeerName" name="reportBeerName" class="form-input" 
                                   placeholder="Start typing beer name..." 
                                   autocomplete="off" data-action="search-beer-names">>
                            <div id="beerNameDropdown" class="suggestions beer-suggestions"></div>
                        </div>
                    </div>
                    
                    <!-- Beer Style (Auto-complete based on selected beer) -->
                    <div class="form-group">
                        <label class="form-label">Beer Style</label>
                        <div class="beer-style-container">
                            <input type="text" id="reportBeerStyle" name="reportBeerStyle" class="form-input" 
                                   placeholder="IPA, Lager, Stout..." 
                                   autocomplete="off" data-action="search-beer-styles">
                            <div id="beerStyleDropdown" class="suggestions style-suggestions"></div>
                        </div>
                    </div>
                    
                    <!-- Beer ABV (Auto-complete based on selected beer) -->
                    <div class="form-group">
                        <label class="form-label">ABV (Alcohol %)</label>
                        <input type="number" id="reportBeerABV" name="reportBeerABV" class="form-input" 
                               placeholder="4.5" step="0.1" min="0" max="20">
                    </div>
                    
                    <!-- Compact Photo Upload -->
                    <div class="form-group">
                        <label class="form-label">Photo (Optional)</label>
                        <label for="reportPhoto" class="photo-upload-compact">
                            <div class="photo-upload-icon">üì∑</div>
                            <input type="file" id="reportPhoto" name="reportPhoto" 
                                   accept="image/*" style="display: none;">
                        </label>
                    </div>
                    
                    <!-- Form Actions (Sticky at bottom) -->
                    <div class="form-actions">
                        <button type="button" onclick="closeModal('reportModal')" class="btn btn-secondary">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-success">
                            Submit Report
                        </button>
                    </div>
                    
                </form>
            </div>
        </div>
    </div>

    <template id="pub-result-template">
        <div class="result-item">
            <div class="result-header">
                <div class="result-main-info">
                    <h3 class="result-title"></h3>
                    <div class="result-distance"></div>
                </div>
                <div class="gf-indicator"></div>
            </div>
            
            <div class="result-location">
                <div class="result-address"></div>
                <div class="result-postcode"></div>
                <div class="result-authority"></div>
            </div>
            
            <div class="result-actions">
                <button class="btn btn-primary" data-action="view-pub">
                    üìç View Details
                </button>
            </div>
        </div>
    </template>
    
    <!-- Loading Toast - UPDATED -->
    <div id="loadingToast" class="toast toast-loading" style="display: none;">
        <div class="toast-content">
            <div class="spinner"></div>
            <span id="loadingMessage">Loading...</span>
        </div>
    </div>
    
    <!-- Success Toast - UPDATED -->
    <div id="successToast" class="toast toast-success" style="display: none;">
        <div class="toast-content">
            <span class="toast-icon">‚úÖ</span>
            <span id="successMessage">Success!</span>
        </div>
    </div>
    
    <!-- Cookie Consent Banner -->
    <div id="cookieConsent" class="cookie-consent" style="display: none;">
        <div class="cookie-content">
            <div class="cookie-text">
                <h4>üç™ We use cookies</h4>
                <p>We use essential cookies to make our site work. With your consent, we may also use analytics cookies to improve your experience.</p>
            </div>
            <div class="cookie-buttons">
                <button data-action="accept-all-cookies" class="cookie-btn cookie-btn-accept">Accept All</button>
                <button data-action="accept-essential-cookies" class="cookie-btn cookie-btn-essential">Essential Only</button>
                <button data-modal="cookieSettings" class="cookie-btn cookie-btn-settings">Settings</button>
            </div>
        </div>
    </div>
    
    <!-- Cookie Settings Modal -->
    <div id="cookieSettings" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üç™ Cookie Settings</h2>
                <button class="modal-close" aria-label="Close cookie settings">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="cookie-settings-content">
                    <div class="cookie-category">
                        <div class="cookie-category-header">
                            <h3>Essential Cookies</h3>
                            <label class="cookie-toggle">
                                <input type="checkbox" checked disabled>
                                <span class="toggle-slider essential"></span>
                            </label>
                        </div>
                        <p>These cookies are necessary for the website to function and cannot be switched off. They are usually only set in response to actions made by you which amount to a request for services.</p>
                        <div class="cookie-details">
                            <strong>Examples:</strong> Session management, search preferences, location consent
                        </div>
                    </div>
                    
                    <div class="cookie-category">
                        <div class="cookie-category-header">
                            <h3>Analytics Cookies</h3>
                            <label class="cookie-toggle">
                                <input type="checkbox" id="analyticsConsent">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <p>These cookies help us understand how visitors interact with our website by collecting and reporting information anonymously. This helps us improve our service.</p>
                        <div class="cookie-details">
                            <strong>Provider:</strong> Google Analytics<br>
                            <strong>Purpose:</strong> Usage statistics, popular features, performance monitoring
                        </div>
                    </div>
                    
                    <div class="cookie-info">
                        <h4>üìã Your Rights</h4>
                        <ul>
                            <li>You can change your preferences at any time</li>
                            <li>Withdrawing consent may limit website functionality</li>
                            <li>Essential cookies cannot be disabled</li>
                            <li>See our <a href="/cookies" target="_blank">Cookie Policy</a> for full details</li>
                        </ul>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button data-action="save-cookie-preferences" class="btn btn-primary">Save Preferences</button>
                    <button data-action="accept-all-from-settings" class="btn btn-success">Accept All</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Floating Cookie Settings Button (appears after consent given) -->
    <div id="cookieSettingsFloat" class="cookie-settings-float" style="display: none;">
        <button data-action="show-cookie-settings" class="cookie-float-btn" title="Cookie Settings">
            üç™
        </button>
    </div>

    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav">
        <a href="/" class="nav-item active">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">Home</div>
        </a>
        
        <a href="#" onclick="toggleSearchResultsFullMap(); return false;" class="nav-item">
            <div class="nav-icon">üó∫Ô∏è</div>
            <div class="nav-label">Map</div>
        </a>
        
        <a href="/breweries" class="nav-item">
            <div class="nav-icon">üç∫</div>
            <div class="nav-label">Breweries</div>
        </a>
        
        <a href="/about" class="nav-item">
            <div class="nav-icon">‚ÑπÔ∏è</div>
            <div class="nav-label">About</div>
        </a>
        
        <a href="/more" class="nav-item">
            <div class="nav-icon">‚ãØ</div>
            <div class="nav-label">More</div>
        </a>
    </nav>

    <!---------------------------
    LEAFLET.JS
    ---------------------------->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!---------------------------
    IMPORT MAPS.JS
    ---------------------------->
    <script type="module" src="/static/map.js"></script>
    
    <script type="module">
        import { MapModule } from '/static/map.js';

        window.toggleSearchResultsFullMap = MapModule.toggleSearchResultsFullMap;
            
            // Set up the main map toggle button
            const toggleMapBtn = document.getElementById('toggleMapBtn');
            if (toggleMapBtn) {
                toggleMapBtn.addEventListener('click', () => {
                    MapModule.toggleMap();
                });
            }
            
            // Initialize map if needed
            if (document.getElementById('map')) {
                MapModule.initMainMap();
            }
        
        // Example: When you get user location
        function handleUserLocation(position) {
            const location = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };
            
            // Update the map module
            MapModule.setUserLocation(location);
            
            // Center map on user
            MapModule.centerOnLocation();
        }
        
        // Example: When search results come back
        async function displaySearchResults(pubs) {
            // Your existing display logic...
            
            // Add markers to map
            MapModule.clearPubMarkers();
            MapModule.addPubMarkers(pubs);
            
            // Show map if hidden
            if (!MapModule.isMapVisible()) {
                MapModule.toggleMap();
            }
        }
        
        // Example: Toggle results map
        function toggleSearchResultsFullMap() {
            const listContainer = document.getElementById('resultsListContainer');
            const mapContainer = document.getElementById('resultsMapContainer');
            const mapBtnText = document.getElementById('resultsMapBtnText');
            
            if (mapContainer.style.display === 'none') {
                // Show map
                listContainer.style.display = 'none';
                mapContainer.style.display = 'block';
                mapBtnText.textContent = 'List';
                
                // Initialize results map
                setTimeout(() => {
                    const resultsMap = MapModule.initResultsMap();
                    // Add current search results to map
                    if (window.currentSearchPubs) {
                        MapModule.addPubMarkers(window.currentSearchPubs, resultsMap);
                    }
                }, 100);
            } else {
                // Show list
                listContainer.style.display = 'block';
                mapContainer.style.display = 'none';
                mapBtnText.textContent = 'Map';
            }
        }
        
        // Example: Show pub detail map
        function togglePubDetailsSplitMap() {
            const container = document.getElementById('pubContainer');
            const mapBtn = document.getElementById('pubToggleMap');
            
            const isMapVisible = container.classList.contains('split-view');
            
            if (!isMapVisible) {
                // Show split view
                container.classList.add('split-view');
                mapBtn.classList.add('active');
                
                // Initialize pub map
                if (window.currentPubData) {
                    setTimeout(() => {
                        MapModule.initPubDetailMap(window.currentPubData);
                    }, 300);
                }
            } else {
                // Hide split view
                container.classList.remove('split-view');
                mapBtn.classList.remove('active');
            }
        }
    </script>

    <!---------------------------
    IMPORT API.JS
    ---------------------------->
    <script type="module" src="/static/api.js"></script>
    
    <!-- 2. Import it so you can use it -->
    <script type="module">
        import { APIModule } from '/static/api.js';
        
        window.APIModule = APIModule;
    </script>

    <!---------------------------
    IMPORT SEARCH.JS
    ---------------------------->
    
    <script type="module" src="/static/search.js"></script>
    
    <script type="module">
        import { SearchModule } from '/static/search.js';
        
        window.SearchModule = SearchModule;
        window.closeSearchModal = () => SearchModule.closeSearchModal();
        window.showPubDetails = SearchModule.showPubDetails;
        
    </script>

    <!---------------------------
    IMPORT MODALS.JS
    ---------------------------->
    
    <script type="module" src="/static/modals.js"></script>
    
    <script type="module">
        import { ModalModule } from '/static/modals.js';
        import { SearchModule } from '/static/search.js';
        
        // Make modal module globally available
        window.ModalModule = ModalModule;
        window.updateAreaPlaceholder = ModalModule.updateAreaPlaceholder;
        window.updateBeerPlaceholder = ModalModule.updateBeerPlaceholder;
            
        console.log('‚úÖ Modal event handlers ready!');
        
        // Update any functions that programmatically open modals
        window.showAboutUs = () => ModalModule.open('aboutModal');
        window.showGFInfo = () => ModalModule.open('gfInfoModal');
        window.showCookieSettings = () => ModalModule.open('cookieSettings');
        window.openReportModalForCurrentPub = () => {
            if (window.currentPubData) {
                ModalModule.openReportModal(window.currentPubData);
            } else {
                ModalModule.openReportModal();
            }
        };
    </script>

    <!---------------------------
    IMPORT UTILS.JS
    ---------------------------->

    <script type="module" src="/static/utils.js"></script>
    
    <script type="module">
        import { UtilsModule } from '/static/utils.js';
        
        // Make utilities globally available for existing code
        window.showLoadingToast = UtilsModule.showLoadingToast;
        window.hideLoadingToast = UtilsModule.hideLoadingToast;
        window.showSuccessToast = UtilsModule.showSuccessToast;
        window.animateNumber = UtilsModule.animateNumber;
        window.calculateDistance = UtilsModule.calculateDistance;
        window.escapeHtml = UtilsModule.escapeHtml;
        
        // Make the module available globally
        window.UtilsModule = UtilsModule;
    </script>

    <!---------------------------
    IMPORT CONSTANTS.JS
    ---------------------------->
    
    <script type="module" src="/static/constants.js"></script>
    
    <script type="module">
        import { Constants } from '/static/constants.js';
        
        // Make constants globally available
        window.Constants = Constants;
    </script>

    <!---------------------------
    IMPORT TRACKING.JS
    ---------------------------->
    
    <script type="module" src="/static/tracking.js"></script>
    
    <script type="module">
        import { TrackingModule } from '/static/tracking.js';
        
        // Make tracking module globally available
        window.TrackingModule = TrackingModule;
        
        // The module auto-initializes, but let's ensure it's ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                console.log('‚úÖ Tracking Module ready');
            });
        } else {
            console.log('‚úÖ Tracking Module ready');
        }
    </script>

    <!---------------------------
    IMPORT UI.JS
    ---------------------------->

    <!-- Import UI Module -->
    <script type="module" src="/static/ui.js"></script>
    
    <script type="module">
        import { UIModule } from '/static/ui.js';
        
        // Make UI module and debug globally available
        window.UIModule = UIModule;
        window.showDebugInfo = UIModule.showDebugInfo;  
        window.closeResults = UIModule.closeResults;
        
        // The module auto-initializes
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                console.log('‚úÖ UI Module ready');
            });
        } else {
            console.log('‚úÖ UI Module ready');
        }
    </script>

    <!---------------------------
    IMPORT MAIN.JS
    ---------------------------->
    
    <script type="module" src="/static/main.js"></script>

    <!---------------------------
    EVENT LISTENER
    ---------------------------->

    <script>

         // Set up event delegation for modal triggers
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîß Setting up modal event handlers...');
            
            // Handle data-modal attributes
            document.addEventListener('click', (e) => {
                const modalTrigger = e.target.closest('[data-modal]');
                if (modalTrigger) {
                    e.preventDefault();
                    const modalId = modalTrigger.dataset.modal;
                    ModalModule.open(modalId);
                }
            })
        });
            
        // Handle data-action attributes
        document.addEventListener('click', (e) => {
            const actionTrigger = e.target.closest('[data-action]');
            if (actionTrigger) {
                e.preventDefault();
                const action = actionTrigger.dataset.action;
                
                switch(action) {
                    case 'location-search':
                        SearchModule.startLocationSearch();
                        break;
                    case 'search-name':
                        SearchModule.searchByName();
                        break;
                    case 'search-area':
                        SearchModule.searchByArea();
                        break;
                    case 'search-beer':
                        SearchModule.searchByBeer();
                        break;
                    case 'close-modal':
                        const modal = actionTrigger.closest('.modal, .search-modal');
                        if (modal && modal.id) {
                            ModalModule.close(modal.id);
                        }
                        break;
                    case 'report-beer':
                        // Check if we're on a pub detail page
                        if (window.currentPubData) {
                            ModalModule.openReportModal(window.currentPubData);
                        } else {
                            ModalModule.openReportModal();
                        }
                        break;
                    case 'accept-all-cookies':
                        acceptAllCookies();
                        break;
                    case 'accept-essential-cookies':
                        acceptEssentialOnly();
                        break;
                    case 'save-cookie-preferences':
                        savesCookiePreferences();
                        break;
                    case 'accept-all-from-settings':
                        acceptAllFromSettings();
                        break;
                    case 'close-pub-details':
                        closePubDetails();
                        break;
                    case 'back-to-results':
                        SearchModule.goBackToResults();
                        break;
                    case 'toggle-pub-map':
                        togglePubDetailsSplitMap();
                        break;
                    case 'close-results':
                        closeResults();
                        break;
                    case 'toggle-results-map':
                        toggleSearchResultsFullMap();
                        break;
                    case 'scroll-to-search':
                        scrollToSearch();
                        break;
                    case 'update-area-placeholder':
                        updateAreaPlaceholder();
                        break;
                    case 'update-beer-placeholder':
                        updateBeerPlaceholder();
                        break;
                }
            }
        });

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing modular map system...');
            
        // Handle distance options
        document.addEventListener('click', (e) => {
            const distanceOption = e.target.closest('[data-distance]');
            if (distanceOption) {
                const distance = parseInt(distanceOption.dataset.distance);
                SearchModule.searchNearbyWithDistance(distance);
            }
        });
        
        // Handle admin modals
        document.addEventListener('click', (e) => {
            const adminTrigger = e.target.closest('[data-admin-modal]');
            if (adminTrigger) {
                const modalType = adminTrigger.dataset.adminModal;
                ModalModule.openAdminModal(modalType);
            }
        });
        
        // Handle coming soon links
        document.addEventListener('click', (e) => {
            const comingSoon = e.target.closest('[data-coming-soon]');
            if (comingSoon) {
                e.preventDefault();
                const feature = comingSoon.dataset.comingSoon;
                showComingSoon(feature);
            }
        });
        
        // Handle form submissions
        document.addEventListener('submit', (e) => {
            const form = e.target;
            if (form.dataset.action === 'submit-report') {
                e.preventDefault();
                handleReportSubmission(e);
            }
        });
        
        // Handle input events
        document.addEventListener('input', (e) => {
            const input = e.target;
            if (input.dataset.action) {
                switch(input.dataset.action) {
                    case 'search-breweries':
                        searchBreweries(input.value);
                        break;
                    case 'search-beer-names':
                        searchBeerNames(input.value);
                        break;
                    case 'search-beer-styles':
                        searchBeerStyles(input.value);
                        break;
                }
            }
        });
            
        // Handle select changes
        document.addEventListener('change', (e) => {
            const select = e.target;
            if (select.dataset.action) {
                switch(select.dataset.action) {
                    case 'update-area-placeholder':
                        updateAreaPlaceholder();
                        break;
                    case 'update-beer-placeholder':
                        updateBeerPlaceholder();
                        break;
                }
            }
        });
        
        // Handle navigation
        document.addEventListener('click', (e) => {
            const navTrigger = e.target.closest('[data-navigate]');
            if (navTrigger) {
                e.preventDefault();
                const url = navTrigger.dataset.navigate;
                window.location.href = url;
            }
        });

        // Add this in your DOMContentLoaded event listener section
        document.addEventListener('click', (e) => {
            if (e.target.matches('[data-action="view-pub"]')) {
                const pubId = e.target.dataset.pubId;
                SearchModule.showPubDetails(pubId);
            }
        });

        // JavaScript to handle file upload preview
        document.addEventListener('DOMContentLoaded', function() {
            const photoInput = document.getElementById('reportPhoto');
            const photoLabel = document.querySelector('.photo-upload-compact');
            
            if (photoInput && photoLabel) {
                photoInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const fileName = file.name.length > 20 ? 
                            file.name.substring(0, 17) + '...' : 
                            file.name;
                        
                        photoLabel.querySelector('.photo-upload-text').innerHTML = `
                            <strong>üì∏ ${fileName}</strong><br>
                            <small>Click to change photo</small>
                        `;
                        photoLabel.style.borderColor = 'var(--success-color, #10b981)';
                        photoLabel.style.background = 'rgba(16, 185, 129, 0.05)';
                    }
                });
            }
        });
    </script>
    
    <script>
        // Cache-busting timestamp -->
        console.log('üöÄ CACHE BUSTER:', '{{ cache_buster }}');
    </script>

</body>
</html>
